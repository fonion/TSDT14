%% study2
N = 2^10;
x = randn(N, 1);
n = linspace(0, 1, N);
R0 = 1;
theta_norm = linspace(0,1,N);
theta0 = 0.1; %Dåligt namn ... ? Cutoff?

%% skapar filtrerat brus
[b a] = butter(10, theta0);
filter_noise = filter(b, a, x);


%% Squarer

Ysquare = filter_noise.^2;

%% Half-wave rectifier

Yhalf = stepfunction(filter_noise);

%% AM-SC modulator

omega0 = (2*pi*(theta0/2));

Yamsc = (filter_noise' .* cos(omega0 * n))';

%% Create periodograms

Ysquare_per = fftshift(abs(PeriodFourier(Ysquare)));
Yhalf_per = fftshift(abs(PeriodFourier(Yhalf)));
Yamsc_per = fftshift(abs(PeriodFourier(Yamsc)));

%% Plot estimated PSD:s

figure(1);
subplot(131);
plot(theta_norm,Ysquare_per);
title('Ysquare nonlin')
subplot(132);
plot(theta_norm, Yhalf_per);
title('Yhalf nonlin')
subplot(133);
plot(theta_norm, Yamsc_per);
title('Yamsc nonlin')

%% Create theoretical PSD:s

%Ysquared_theor=

yhalf2 = triangularPulse(theta_norm/theta0);

Yhalf_theor = R0/(2 * theta0^2) * ( dirac(theta_norm)/pi + ...
    1/2 .* rectangularPulse(theta_norm /theta0) + theta0/(2 * pi) .* ...
    triangularPulse(theta_norm/theta0));

Yamsc_theor = R0/(4 * theta0) * (rectangularPulse((theta_norm+omega0)/theta0)...
    * rectangularPulse((theta_norm - omega0)/theta0));

figure(2);
%subplot(131);
%plot(theta_norm,Ysquare_theor);
%title('Ysquare nonlin theor')
subplot(132);
plot(theta_norm, fftshift(abs(Yhalf_theor)));
title('Yhalf nonlin theor')
subplot(133);
plot(theta_norm, Yamsc_theor);
title('Yamsc nonlin theor')